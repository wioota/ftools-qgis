<?xml version="1.0"?>
<manageRTools>
<RTool name="Insert random R commands" query="|1|">
<Parameter label="R commands:" type="textEdit" default="ls()" notnull="true"/>
</RTool>
<RTool name="Voronoi polygons" query="
voronoipolygons &lt;- function(layer){&#xA;
  require(deldir)&#xA;
  crds &lt;- layer@coords&#xA;
  z &lt;- deldir(crds[,1], crds[,2])&#xA;
  w &lt;- tile.list(z)&#xA;
  polys &lt;- vector(mode='list', length=length(w))&#xA;
  require(sp)&#xA;
  for (i in seq(along=polys)) {&#xA;
    pcrds &lt;- cbind(w[[i]]$x, w[[i]]$y)&#xA;
    pcrds &lt;- rbind(pcrds, pcrds[1,])&#xA;
    polys[[i]] &lt;- Polygons(list(Polygon(pcrds)), ID=as.character(i))&#xA;
  }&#xA;
  SP &lt;- SpatialPolygons(polys)&#xA;
  voronoi &lt;- SpatialPolygonsDataFrame(SP, data=data.frame(x=crds[,1], &#xA;
  y=crds[,2], row.names=sapply(slot(SP, 'polygons'), function(x) slot(x, 'ID'))))&#xA;
}&#xA;
|1|.voronoi &lt;- voronoipolygons(|1|)">
<Parameter label="Point layer:" type="spComboBox" default="SpatialPointsDataFrame" notnull="true"/>
</RTool>
<RTool name="Polygon centroids" query="
polygoncentroids &lt;- function(layer){&#xA;
  proj &lt;- proj4string(layer)&#xA;
  coords &lt;- coordinates(layer)&#xA;
  attrs &lt;- layer@data&#xA;
  centroids &lt;- SpatialPointsDataFrame(coords=coords, &#xA;
  data=attrs, proj4string=CRS(proj))&#xA;
}&#xA;
|1|.centroids &lt;- polygoncentroids(|1|)">
<Parameter label="Polygon layer:" type="spComboBox" default="SpatialPolygonsDataFrame" notnull="true"/>
</RTool>
<RTool name="Spatial weights" query="
computeweights &lt;- function(layer, decay, style, type, value) {&#xA;
    require(rgdal)&#xA;
    require(Matrix)&#xA;
    require(spdep)&#xA;
    if (type == 'CONTIG') {&#xA;
        dist.temp = poly2nb(pl=layer, snap=0.0005, queen=useTrue) #Better parameter for snap?&#xA;
        if (value >= 2) {&#xA;
            nblags = nblag(neighbours=dist.temp, maxlag=value)&#xA;
            weights = nblag_cumul(nblags=nblags)&#xA;
            # use the following line to write to file&#xA;
            # write.nb.gal(nb=dist, file=outpath, oldstyle=F, &#xA;
            # shpfile=filepath, ind=fieldname)&#xA;
          # } else {&#xA;
            #      write.nb.gal(nb=dist.temp, file=outpath, &#xA;
            # oldstyle=F, shpfile=filepath, ind=fieldname)&#xA;
        }&#xA;
    } else {&#xA;
        ids = layer[fieldname]&#xA;
        proj = proj4string(layer)&#xA;
        coords = coordinates(obj=layer)&#xA;
        output = SpatialPoints(coords=coords, proj4string=CRS(proj))&#xA;
        if (type == 'DIST') {&#xA;
            dist = dnearneigh(x=output, d1=0, d2=value, row.names=ids)&#xA;
        } else { # 'KNEAR'&#xA;
            knear = knearneigh(x=output, k=value)&#xA;
            dist = knn2nb(knn=knear, row.names=ids, sym=F)&#xA;
        }&#xA;
        dlist = nbdists(nb=dist, coords=output)&#xA;
        idlist = lapply(X=dlist, FUN=function(x) 1/(x**decay))&#xA;
        weights = nb2listw(neighbours=dist, glist=idlist, style=style, zero_policy=T)&#xA;
        # sn = listw2sn(weights)&#xA;
        # write.sn2gwt(sn=sn, file=outpath, shpfile=filepath, ind=fieldname)&#xA;
    }&#xA;
}&#xA;
#weights = computeweights(|1|, |2|, |3|, |4|, |5|)">
<Parameter label="Layer:" type="spComboBox" default="SpatialPolygonsDataFrame;SpatialPointsDataFrame;SpatialLinesDataFrame" notnull="true"/>
<Parameter label="Decay:" type="doubleSpinBox" default="2.00" notnull="true"/>
<Parameter label="Style:" type="comboBox" default="'W';'B';'C';'U';'S'" notnull="true"/>
<Parameter label="Type:" type="comboBox" default="'CONTIG';'DIST';'KNEAR'" notnull="true"/>
<Parameter label="Value:" type="doubleSpinBox" default="50.00" notnull="true"/>
</RTool>
</manageRTools>